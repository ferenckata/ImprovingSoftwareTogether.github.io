<!DOCTYPE html>
<html class="no-js" lang="en">
<head>

    <!--- basic page needs
    ================================================== -->
    <meta charset="utf-8">
    <title>Testing</title>
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- mobile specific metas
    ================================================== -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- CSS
    ================================================== -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/vendor.css">
    <link rel="stylesheet" href="css/main.css">

    <!-- script
    ================================================== -->
    <script src="js/modernizr.js"></script>

</head>

<body class="ss-bg-white">

    <!-- preloader
    ================================================== -->
    <div id="preloader">
        <div id="loader" class="dots-fade">
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>

    <div id="top" class="s-wrap site-wrapper">

        <!-- site header
        ================================================== -->
        <header class="s-header header">

            <div class="header__top">
                <div class="header__logo">
                    <a class="site-logo" href="index.html">
                        <img src="images/logo.svg" alt="Homepage">
                    </a>
                </div>
            </div> <!-- end header__top -->

            <nav class="header__nav-wrap">

                <ul class="header__nav">
                    <li><a href="index.html" title="">Home</a></li>
                    <li class="has-children">
                        <a href="page-about.html" title="">Categories</a>
                        <ul class="sub-menu">
                        <li><a href="category_literature.html">Literature</a></li>
                        <li><a href="category_examples.html">Examples</a></li>
                        <li><a href="category_experience.html">Experience</a></li>
                        </ul>
                    </li>
                    <li><a href="page-about.html" title="">About</a></li>
                    <li><a href="page-contact.html" title="">Contact</a></li>
                </ul> <!-- end header__nav -->

            </nav> <!-- end header__nav-wrap -->

            <!-- menu toggle -->
            <a href="#0" class="header__menu-toggle">
                <span>Menu</span>
            </a>

        </header> <!-- end s-header -->

        <!-- search
        ================================================== -->
        <div class="s-search">

            <div class="search-block">
    
                <form role="search" method="get" class="search-form" action="#">
                    <label>
                        <span class="hide-content">Search for:</span>
                        <input type="search" class="search-field" placeholder="Type Keywords" value="" name="s" title="Search for:" autocomplete="off">
                    </label>
                    <input type="submit" class="search-submit" value="Search">
                </form>
    
                <a href="#0" title="Close Search" class="search-close">Close</a>
    
            </div>  <!-- end search-block -->

            <!-- search modal trigger -->
            <a href="#0" class="search-trigger">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" style="fill:rgba(0, 0, 0, 1);transform:;-ms-filter:"><path d="M10,18c1.846,0,3.543-0.635,4.897-1.688l4.396,4.396l1.414-1.414l-4.396-4.396C17.365,13.543,18,11.846,18,10 c0-4.411-3.589-8-8-8s-8,3.589-8,8S5.589,18,10,18z M10,4c3.309,0,6,2.691,6,6s-2.691,6-6,6s-6-2.691-6-6S6.691,4,10,4z"></path></svg>
                <span>Search</span>
            </a>
            <span class="search-line"></span>

        </div> <!-- end s-search -->


        <!-- site content
        ================================================== -->
        <div class="s-content content">
            <main class="row content__page">
                
                <article class="column large-full entry format-standard">

                    <div class="media-wrap entry__media">
                        <div class="entry__post-thumb">
                            <!-- <img src="images/thumbs/single/standard/standard-1000.jpg" srcset="images/thumbs/single/standard/standard-2000.jpg 2000w, images/thumbs/single/standard/standard-1000.jpg 1000w, images/thumbs/single/standard/standard-500.jpg 500w" sizes="(max-width: 2000px) 100vw, 2000px" alt=""> -->
                        </div>
                    </div>

                    <div class="content__page-header entry__header">
                        <h1 class="display-1 entry__title">
                        Testing
                        </h1>
                        <ul class="entry__header-meta">
                            <li class="author">By <a href="page-about.html">NCMM SQ team</a></li>
                            <li class="date">August 7, 2024</li>
                            <li class="cat-links">
                                <a href="category_literature.html">Literature</a>
                                <a href="category_examples.html">Examples</a>
                            </li>
                        </ul>
                    </div>
                    <!-- end entry__header -->

                    <div class="entry__content">

                        <p class="lead drop-cap">
                            The correctness of scientific findings relies on that of scientific software. A cautionary tale was presented by <a href="https://www.science.org/doi/10.1126/science.314.5807.1856">Greg Miller</a>: in which five papers had to be retracted due to a bug in the software. The incorrect protein structure confused the field even before this retraction, as people doubted their different but valid structures. Proper tests can both reduce the number of errors and inspire confidence in one’s software. We would like to reiterate the importance of considering unit testing and verification for scientific software.
                        </p>
                        <p>
                            Testing is a central concept in team programming, as test coverage increases trust and allows any member (including the developer's future self) to add new features safely. However, as highlighted in the literature (<a href="https://doi.org/10.1016/j.infsof.2014.05.006">10.1016/j.infsof.2014.05.006</a>, <a href="https://doi.org/10.1109/MS.2008.85">10.1109/MS.2008.85</a>, <a href="https://doi.org/10.1109/MIC.2014.88">10.1109/MIC.2014.88</a>), testing is complex for scientific software. Scientific software development requires dedicated testing methods to maintain scientific integrity since unexpected discoveries can confound expected outcomes and error detection.

                            Scientists often evaluate the validity of a model but usually do not rigorously test the underlying code. This oversight arises from the common misconception that a model and its implementation are the same thing (<a href="https://doi.org/10.1016/j.infsof.2014.05.006">10.1016/j.infsof.2014.05.006</a>). As they are not, faults in the software can interfere with the model itself. The main challenge usually lies in viewing software testing as more than just validating the scientific features of the software on a small test dataset. This requires examining the software implementation from multiple perspectives through several test cases. We view testing not as a form of quality control that acts as a checkpoint but as part of an iterative development process.

                            Revisiting testing multiple times in our sessions helps build an intuition about its nature and usage. These include discussing how to write unit tests in both Python (<code>pytest</code> and <code>unittest</code>) and R (<code>testthat</code>) as comparing languages allowed us to highlight the similarities and specificities of unit testing implementations. We also extensively discussed the type of functions to test, as bioinformaticians deal with both existing and new code that requires a different approach. We could also touch upon the automation of tests via continuous integration (e.g., GitHub Actions), which helps safely modify the code base throughout the development process and in maintenance. 

                            Similarly to <a href="https://ferenckata.github.io/ImprovingSoftwareTogether.github.io/modularization.html">modularization</a>, a recurring question was when to start adding tests. We advise testing early, departing from the mindset: “I will start tomorrow after implementing this new idea.” Peer reviews challenge the implementation, and code reviews provide an optimal platform to discuss tests. This aspect can be viewed as a scientific endeavor when we envision the edge cases and discuss the scientific problem the software aims to address.

                            When working with analysis pipelines, we can (not always safely) assume that the used packages are thoroughly tested by their developer, so what remains for us is to ensure that the steps connect well. It can be viewed as a form of integration testing, where different test examples can be passed through the pipeline. The developer of such a pipeline can think about cases that might break the flow (e.g., missing output from one step). The <a href="https://www.nextflow.io/docs/latest/index.html">Nextflow</a> workflow system has further support for testing. To check the behavior of the individual steps, one may consult the <a href="https://www.nf-test.com/">nf-test</a> framework.
                        </p>


                        <h2>Testing examples</h2>
                        <p>
                            Here we present an example of testing novel scientific code, represented by a subset of tests used by the <a href=”https://github.com/ladislav-hovan/sponge”>SPONGE</a> package. The unit tests check the correctness of individual functions. Some of the tests shown test the <code>plogp</code> function, which calculates the value of <var>p*log2(p)</var> while treating the zero case correctly. Selected content of <code>tests/test_helper_functions.py</code> is shown below.
                        </p>

<pre><code class="language-">
    import pytest
    import sponge.helper_functions

    # Parametrize allows testing multiple
    # inputs without code duplication

    @pytest.mark.parametrize(
        "input,
        expected_output",
            [
            (0, 0),
            (0.5, -0.5),
            (1, 0)
            ]
        )

    def test_plogp(input, expected_output):
        assert helper_functions.plogp(input) == expected_output
</code></pre>

                        <p>
                            Also tested is the calculation of the information content for individual motifs in the <code>calculate_ic</code> function. The motifs used by the tests are defined in a separate file <code>test_motifs</code> and accessible as <code>pytest</code> fixtures.
                        </p>

<pre><code class="language-">
    import pytest
    import pandas as pd
    from Bio.motifs.jaspar import Motif
    from pyjaspar import jaspardb

    # A motif without any information
    @pytest.fixture
    def no_info_motif():
        no_info_row = [0.25] * 4
        no_info_counts = [no_info_row] * 6
        no_info_pwm = pd.DataFrame(no_info_counts, columns=['A', 'C', 'G', 'T'])
        no_info_motif = Motif(matrix_id='XXX', name='XXX', counts=no_info_pwm)

    yield no_info_motif

    # A motif with perfect information
    @pytest.fixture
    def all_A_motif():
        all_A_row = [1] + [0] * 3
        all_A_counts = [all_A_row] * 6
        all_A_pwm = pd.DataFrame(all_A_counts, columns=['A', 'C', 'G', 'T'])
        all_A_motif = Motif(matrix_id='XXX', name='XXX', counts=all_A_pwm)

    yield all_A_motif

    # A real motif for SOX2
    @pytest.fixture
    def SOX2_motif():
        jdb_obj = jaspardb(release='JASPAR2024')
        SOX2_motif = jdb_obj.fetch_motif_by_id('MA0143.1')
        
    yield SOX2_motif
</code></pre>

                        <p>
                            Selected content of <code>tests/test_helper_functions.py</code> is shown below.
                        </p>

<pre><code class="language-">
    import pytest
    from test_motifs import *
    from sponge.helper_functions import calculate_ic


    def test_calculate_ic_no_info(no_info_motif):
        assert calculate_ic(no_info_motif) == 0


    def test_calculate_ic_all_the_same(all_A_motif):
        # Length of the test motif is 6, so expected value is 2 * 6 = 12
        assert calculate_ic(all_A_motif) == 12


    def test_calculate_ic_SOX2(SOX2_motif):
        assert calculate_ic(SOX2_motif) == pytest.approx(12.95, abs=0.01)
</code></pre>

                        <p>
                            The integration tests check that the entire workflow produces the expected output, effectively checking that the components work well together. In this case, the full functionality of SPONGE with the default parameters is checked. Selected content of <code>tests/test_sponge.py</code> is shown below.
                        </p>

<pre><code class="language-">
    import os
    import pytest
    from sponge.sponge import Sponge

    # The test is marked as slow because the download of the bigbed file takes
    # a lot of time and the filtering is also time consuming unless parallelised

    @pytest.mark.slow
    def test_full_default_workflow(tmp_path):

        # Tests the full SPONGE workflow with default values
        ppi_output = os.path.join(tmp_path, 'ppi_prior.tsv')
        motif_output = os.path.join(tmp_path, 'motif_prior.tsv')

        sponge_obj = Sponge(
            run_default=True,
            temp_folder=tmp_path,
            ppi_outfile=ppi_output,
            motif_outfile=motif_output,
        )

        assert os.path.exists(ppi_output)
        assert os.path.exists(motif_output)
</code></pre>


                        <p class="entry__tags">
                            <span>Post Tags</span>
        
                            <span class="entry__tag-list">
                                <a href="#0">code</a>
                                <a href="#0">bioinformatics</a>
                            </span>
            
                        </p>
                    </div>
                    <!-- end entry content -->

                </article> <!-- end column large-full entry-->

            </main>

        </div> <!-- end s-content -->

        <!-- footer
        ================================================== -->
        <footer class="s-footer footer">
            <div class="row">
                <div class="column large-full footer__content">
                    <div class="footer__copyright">
                        <span>© Copyright Typerite 2021</span> 
                        <span>Design by <a href="https://www.styleshout.com/">StyleShout</a></span>
                    </div>
                </div>
            </div>

            <div class="go-top">
                <a class="smoothscroll" title="Back to Top" href="#top"></a>
            </div>
        </footer>

    </div> <!-- end s-wrap -->


    <!-- Java Script
    ================================================== -->
    <script src="js/jquery-3.2.1.min.js"></script>
    <script src="js/plugins.js"></script>
    <script src="js/main.js"></script>

</body>